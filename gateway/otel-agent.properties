# OpenTelemetry Agent Configuration for Gateway Service
# Gateway sử dụng Spring WebFlux (reactive stack) - tương tự face service
otel.service.name=gateway-service
otel.resource.attributes=service.name=gateway-service,service.version=1.0.0

# Tắt tất cả export để tránh lỗi kết nối (giống face service)
otel.traces.exporter=none
otel.metrics.exporter=none
otel.logs.exporter=none

# Tắt hoàn toàn OTLP exporter
otel.exporter.otlp.traces.endpoint=
otel.exporter.otlp.metrics.endpoint=
otel.exporter.otlp.logs.endpoint=

# Cấu hình sampling (chỉ để debug)
otel.traces.sampler=always_on

# Tắt các instrumentation không cần thiết để tăng performance
otel.instrumentation.runtime-telemetry-java8.enabled=false
otel.instrumentation.runtime-telemetry-java11.enabled=false
otel.instrumentation.runtime-telemetry-java17.enabled=false

# Tắt hoàn toàn Log4j1 và Logback MDC
otel.instrumentation.log4j-mdc.enabled=false
otel.instrumentation.logback-mdc.enabled=false

# Bật tất cả Log4j2 instrumentation (version 1.32.0 tự detect)
otel.instrumentation.log4j-appender.enabled=true
otel.instrumentation.log4j-context-data.enabled=true

# WebFlux specific instrumentation cho Gateway - FORCE BẬT
otel.instrumentation.spring-webflux.enabled=true
otel.instrumentation.netty.enabled=true
otel.instrumentation.spring-boot.enabled=true
otel.instrumentation.reactor.enabled=true
otel.instrumentation.reactor-netty.enabled=true

# Bật tất cả HTTP-related instrumentation để đảm bảo spans được tạo
otel.instrumentation.spring-webflux-webclient.enabled=true
otel.instrumentation.spring-cloud-gateway.enabled=true

# BẬT servlet instrumentation vì Gateway thực tế đang chạy trên Tomcat!
otel.instrumentation.servlet.enabled=true
otel.instrumentation.tomcat.enabled=true
otel.instrumentation.spring-webmvc.enabled=true
otel.instrumentation.spring-web.enabled=true

# Bật HTTP client instrumentation cho downstream calls
otel.instrumentation.http.enabled=true
otel.instrumentation.httpclient.enabled=true

# Chỉ show log quan trọng của agent - tạm thời bật INFO để debug
otel.javaagent.logging=info

# Tắt debug logging cho production
otel.javaagent.debug=false

# Minimal instrumentation config cho production

# Cấu hình MDC keys cho Log4j2 (giống face service)
otel.instrumentation.common.mdc-attributes=traceId,spanId,serviceName

# Đảm bảo context propagation hoạt động cho distributed tracing
otel.propagators=tracecontext,baggage,b3

# QUAN TRỌNG: Force instrumentation cho tất cả HTTP requests
otel.instrumentation.http.server.route-based-naming=false
otel.instrumentation.spring-cloud-gateway.experimental-span-attributes=true

# Core instrumentation cần thiết
otel.instrumentation.spring-webflux.enabled=true
otel.instrumentation.netty.enabled=true
otel.instrumentation.reactor.enabled=true
